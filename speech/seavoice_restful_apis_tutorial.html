<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
<meta content="text to speech, speech to text, api, rest, python, documentation, tutorial, customization" name="keywords" />
<meta content="restful api documentation and tutorial for seavoice cutting edge text to speech and speech to text services" lang="en" name="description" xml:lang="en" />
<meta content="seavoice最先進的語音轉文字以及文字轉語音服務的RESTful API接口教學文檔" lang="zh" name="description" xml:lang="zh" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SeaVoice RESTful APIs &mdash; Seasalt.ai Documentation 0.0.1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="SeaAuth Overview" href="../auth/readme.html" />
    <link rel="prev" title="SeaVoice Python SDK" href="seavoice_sdk_python_tutorial.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >

          
          
          <a href="../index.html" class="icon icon-home">
            Seasalt.ai Documentation
              <img src="../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Product Introductions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../product_introduction/seavoice.html">SeaVoice</a></li>
<li class="toctree-l1"><a class="reference internal" href="../product_introduction/seaauth.html">SeaAuth</a></li>
<li class="toctree-l1"><a class="reference internal" href="../product_introduction/seax.html">SeaX</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">SeaWord</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../nlp/v1/index.html">SeaWord v1 APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nlp/v2/index.html">SeaWord v2 APIs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">SeaVoice (Seasalt speech)</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="readme.html">SeaVoice README</a></li>
<li class="toctree-l1"><a class="reference internal" href="seavoice_sdk_python_tutorial.html">SeaVoice SDK (Python)</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">SeaVoice RESTful APIs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">SeaAuth</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../auth/readme.html">SeaAuth Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">SeaX</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contact_center/readme.html">SeaX Overview</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Seasalt.ai Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">SeaVoice RESTful APIs</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/speech/seavoice_restful_apis_tutorial.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="seavoice-restful-apis">
<span id="seavoice-restful-apis-tutorial"></span><h1>SeaVoice RESTful APIs<a class="headerlink" href="#seavoice-restful-apis" title="Permalink to this heading"></a></h1>
<p>This is the tutorial about how to use SeaVoice RESTful APIs to try Seasalt Speech-To-Text (STT) and Text-To-Speech (TTS) services.</p>
<p>Please contact <a class="reference external" href="mailto:info&#37;&#52;&#48;seasalt&#46;ai">info<span>&#64;</span>seasalt<span>&#46;</span>ai</a> if you have any questions.</p>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#stt-protocols" id="id1">STT protocols</a></p>
<ul>
<li><p><a class="reference internal" href="#sample-client-script-stt" id="id2">Sample Client Script (STT)</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#tts-protocols" id="id3">TTS protocols</a></p>
<ul>
<li><p><a class="reference internal" href="#sample-client-script-tts" id="id4">Sample Client Script (TTS)</a></p></li>
<li><p><a class="reference internal" href="#supported-ssml-tags" id="id5">Supported SSML Tags</a></p></li>
<li><p><a class="reference internal" href="#special-symbol-handling" id="id6">Special Symbol Handling</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="stt-protocols">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">STT protocols</a><a class="headerlink" href="#stt-protocols" title="Permalink to this heading"></a></h2>
<ol class="arabic simple">
<li><p>Log into SeaAuth: <code class="docutils literal notranslate"><span class="pre">https://seaauth.seasalt.ai/api/v1/users/login</span></code></p></li>
</ol>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;username&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;password&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;scope&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;seavoice&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Obtain access token in the response</p></li>
</ol>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;account&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;access_token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eyJ0eXAiOi*****&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;token_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Bearer&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;refresh_token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;71bbffd5368*****&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Refresh access token if it is expired</p></li>
</ol>
<blockquote>
<div><p>3.1 check token lifetime</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">jwt</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">&quot;eyJ0eXAiOiJKV1.....&quot;</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">jwt</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;verify_signature&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;exp&quot;</span><span class="p">]))</span>
<span class="c1"># 2022-12-06 12:42:54</span>
</pre></div>
</div>
<p>3.2 refresh token with <code class="docutils literal notranslate"><span class="pre">https://seaauth.seasalt.ai/api/v1/users/rotate_token</span></code></p>
<p>input payload</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;access_token&quot;</span><span class="p">:</span> <span class="s2">&quot;eyJ0eXAiOi*****&quot;</span><span class="p">,</span>
   <span class="s2">&quot;refresh_token&quot;</span><span class="p">:</span> <span class="s2">&quot;71bbffd5368*****&quot;</span><span class="p">,</span>
   <span class="s2">&quot;token_type&quot;</span><span class="p">:</span> <span class="s2">&quot;Bearer&quot;</span><span class="p">,</span>
   <span class="s2">&quot;service&quot;</span><span class="p">:</span> <span class="s2">&quot;seavoice&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Output</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;access_token&quot;</span><span class="p">:</span> <span class="s2">&quot;eyJ0esr3hifi*****&quot;</span><span class="p">,</span>
   <span class="s2">&quot;refresh_token&quot;</span><span class="p">:</span> <span class="s2">&quot;fd27g1bfdg53g*****&quot;</span><span class="p">,</span>
   <span class="s2">&quot;token_type&quot;</span><span class="p">:</span> <span class="s2">&quot;Bearer&quot;</span><span class="p">,</span>
   <span class="s2">&quot;service&quot;</span><span class="p">:</span> <span class="s2">&quot;seavoice&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="4">
<li><p>Connect to SeaVoice STT websocket server: <code class="docutils literal notranslate"><span class="pre">wss://seavoice.seasalt.ai/api/v1/stt/ws</span></code></p></li>
</ol>
<p>If successfully connected, Client sends json packages to stt server, for example:</p>
<ul class="simple">
<li><p>authentication command</p></li>
</ul>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;command&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;authentication&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;ACCESS_TOKEN&gt;&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;settings&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;language&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;zh-TW&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;sample_rate&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">16000</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;itn&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;contexts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;Seasalt&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nt">&quot;rewrite&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;sea salt&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;c salt&quot;</span><span class="p">]</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="nt">&quot;SeaVoice&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nt">&quot;rewrite&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;c voice&quot;</span><span class="p">]</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;language&quot;</span></code>: Currently supported languages: <cite>zh-TW</cite>, <cite>en-US</cite></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;sample_rate&quot;</span></code>: sample rate of the audio, e.g. 16000, 44100. Make sure this matches your audio.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;itn&quot;</span></code>: whether to run inverse text normalisation and punctuation to recognition result, e.g. “mister” becomes “mr.”</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;contexts&quot;</span></code>: a json dict to boost certain hotwords and/or phrases for recognition, and optionally rewrite certain spoken forms to a specific written form. Each key is a word/phrase for context biasing; each corresponding value is an optional dict containing a key ‘rewrite’ which maps to a list of possible spoken forms that will be rewritten to the written form (the key). In the above example, the word “seasalt” will be boosted and all occurences of “sea salt” and “c salt” will be rewritten to the capitalised “Seasalt”. Also, if a certain sentence is expected, you can also boost the whole sentence, e.g. “Seasalt is an AI company”</p></li>
</ul>
</div>
<ul class="simple">
<li><p>start recognition command: sending audio data for recognition</p></li>
</ul>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;command&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;audio_data&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;BASE64_ENCODED_AUDIO_DATA&gt;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>stop recognition command</p></li>
</ul>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;command&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;stop&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>STT server receives audio data, performs recognition, and sends recognizing/recognized events to Client</p></li>
</ol>
<ul class="simple">
<li><p>info event (begin)</p></li>
</ul>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;event&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;info&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;begin&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>info event (error)</p></li>
</ul>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;event&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;info&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;error&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;ERROR_MESSAGE&gt;&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;code&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;ERROR_CODE&gt;&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>recognizing event: intermediate streaming ASR results</p></li>
</ul>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;event&quot;</span><span class="p">:</span><span class="w"> </span><span class="nt">&quot;recognizing&quot;</span>
<span class="w">    </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;segment_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;SEG_ID&gt;&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;text&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;PARTIAL_RESULTS&gt;&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;voice_start_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.1</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>recognized event: final ASR results</p></li>
</ul>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;event&quot;</span><span class="p">:</span><span class="w"> </span><span class="nt">&quot;recognized&quot;</span>
<span class="w">    </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;segment_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;SEG_ID&gt;&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;text&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;FINAL_RESULTS&gt;&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;voice_start_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.1</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;duration&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">2.5</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;voice_start_time&quot;</span></code>: timestamp in seconds of that segment relative to the start of the audio.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;duration&quot;</span></code>: duration of that segment.</p></li>
</ul>
</div>
<section id="sample-client-script-stt">
<h3><a class="toc-backref" href="#id2" role="doc-backlink">Sample Client Script (STT)</a><a class="headerlink" href="#sample-client-script-stt" title="Permalink to this heading"></a></h3>
<ol class="arabic simple">
<li><p>Setup</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Python venv setup (recommends using Python 3.8.10)</span>
python3<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>venv/seavoice
<span class="nb">source</span><span class="w"> </span>venv/seavoice/bin/activate
pip<span class="w"> </span>install<span class="w"> </span>--upgrade<span class="w"> </span>pip
pip<span class="w"> </span>install<span class="w"> </span><span class="nv">websockets</span><span class="o">==</span><span class="m">10</span>.3
pip<span class="w"> </span>install<span class="w"> </span><span class="nv">aiohttp</span><span class="o">==</span><span class="m">3</span>.8.1
pip<span class="w"> </span>install<span class="w"> </span><span class="nv">PyJWT</span><span class="o">==</span><span class="m">2</span>.5.0
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Run client script</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1"># Copyright 2022  Seasalt AI, Inc</span>

<span class="sd">&quot;&quot;&quot;Client script for stt endpoint</span>

<span class="sd">prerequisite:</span>
<span class="sd">python 3.8</span>
<span class="sd">python package:</span>
<span class="sd">- aiohttp==3.8.1</span>
<span class="sd">- websockets==10.3</span>
<span class="sd">- PyJWT==2.5.0</span>

<span class="sd">Usage:</span>

<span class="sd">python stt_client.py \</span>
<span class="sd">    --account test \</span>
<span class="sd">    --password test \</span>
<span class="sd">    --lang zh-TW \</span>
<span class="sd">    --enable-itn false \</span>
<span class="sd">    --contexts-file</span>
<span class="sd">    --audio-path test_audio.wav \</span>
<span class="sd">    --sample-rate 8000</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urljoin</span>

<span class="kn">import</span> <span class="nn">aiohttp</span>
<span class="kn">import</span> <span class="nn">jwt</span>
<span class="kn">import</span> <span class="nn">websockets</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
    <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
    <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> [</span><span class="si">%(levelname)s</span><span class="s2">] </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">handlers</span><span class="o">=</span><span class="p">[</span><span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()],</span>
<span class="p">)</span>

<span class="n">SEAAUTH_SCOPE_NAME</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;seavoice&quot;</span>
<span class="n">TOKEN_TYPE</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Bearer&quot;</span>
<span class="n">AUDIO_CHUNK_INTERVAL</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">ACCESS_TOKEN_LIFE_TIME_MINIMUM_IN_SECOND</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">60</span>

<span class="k">class</span> <span class="nc">Language</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
    <span class="n">EN_US</span> <span class="o">=</span> <span class="s2">&quot;en-US&quot;</span>
    <span class="n">ZH_TW</span> <span class="o">=</span> <span class="s2">&quot;zh-TW&quot;</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">):</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Start to get access token.&quot;</span><span class="p">)</span>
    <span class="n">access_token</span> <span class="o">=</span> <span class="k">await</span> <span class="n">_get_access_token</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">_do_stt</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">access_token</span><span class="p">)</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">_get_access_token</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">credential</span> <span class="o">=</span> <span class="n">_get_credential_from_file</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">seaauth_credential_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">credential</span> <span class="ow">and</span> <span class="n">credential</span><span class="p">[</span><span class="s2">&quot;account&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">args</span><span class="o">.</span><span class="n">account</span><span class="p">:</span>
        <span class="n">access_token</span><span class="p">,</span> <span class="n">refresh_token</span> <span class="o">=</span> <span class="n">credential</span><span class="p">[</span><span class="s2">&quot;access_token&quot;</span><span class="p">],</span> <span class="n">credential</span><span class="p">[</span><span class="s2">&quot;refresh_token&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">_is_access_token_expired</span><span class="p">(</span><span class="n">credential</span><span class="p">[</span><span class="s2">&quot;access_token&quot;</span><span class="p">]):</span>
            <span class="n">credential</span> <span class="o">=</span> <span class="k">await</span> <span class="n">_refresh_access_token</span><span class="p">(</span><span class="n">access_token</span><span class="p">,</span> <span class="n">refresh_token</span><span class="p">)</span>
            <span class="n">_save_credential</span><span class="p">(</span>
                <span class="n">args</span><span class="o">.</span><span class="n">account</span><span class="p">,</span> <span class="n">credential</span><span class="p">[</span><span class="s2">&quot;access_token&quot;</span><span class="p">],</span> <span class="n">credential</span><span class="p">[</span><span class="s2">&quot;refresh_token&quot;</span><span class="p">],</span> <span class="n">args</span><span class="o">.</span><span class="n">seaauth_credential_path</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Got access token from </span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">seaauth_credential_path</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">credential</span> <span class="o">=</span> <span class="k">await</span> <span class="n">_login_seaauth</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">account</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">password</span><span class="p">)</span>
        <span class="n">_save_credential</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">account</span><span class="p">,</span> <span class="n">credential</span><span class="p">[</span><span class="s2">&quot;access_token&quot;</span><span class="p">],</span> <span class="n">credential</span><span class="p">[</span><span class="s2">&quot;refresh_token&quot;</span><span class="p">],</span> <span class="n">args</span><span class="o">.</span><span class="n">seaauth_credential_path</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">credential</span><span class="p">[</span><span class="s2">&quot;access_token&quot;</span><span class="p">]</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">_login_seaauth</span><span class="p">(</span><span class="n">account</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Login with SeaAuth.</span>
<span class="sd">    Example of response:</span>
<span class="sd">        {</span>
<span class="sd">            &quot;account&quot;: &quot;test&quot;,</span>
<span class="sd">            &quot;access_token&quot;: &quot;eyJ0eXAiOi*****&quot;,</span>
<span class="sd">            &quot;token_type&quot;: &quot;Bearer&quot;,</span>
<span class="sd">            &quot;refresh_token&quot;: &quot;71bbffd5368*****&quot;</span>
<span class="sd">        }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;logging in to SeaAuth...&quot;</span><span class="p">)</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="n">account</span><span class="p">,</span> <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="n">password</span><span class="p">,</span> <span class="s2">&quot;scope&quot;</span><span class="p">:</span> <span class="n">SEAAUTH_SCOPE_NAME</span><span class="p">}</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">FormData</span><span class="p">()</span>
    <span class="n">data</span><span class="o">.</span><span class="n">add_fields</span><span class="p">(</span><span class="o">*</span><span class="n">payload</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">urljoin</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">seaauth_url</span><span class="p">,</span> <span class="s2">&quot;/api/v1/users/login&quot;</span><span class="p">),</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;logged in to SeaAuth.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">_refresh_access_token</span><span class="p">(</span><span class="n">access_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">refresh_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;refreshing token...&quot;</span><span class="p">)</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;access_token&quot;</span><span class="p">:</span> <span class="n">access_token</span><span class="p">,</span>
        <span class="s2">&quot;refresh_token&quot;</span><span class="p">:</span> <span class="n">refresh_token</span><span class="p">,</span>
        <span class="s2">&quot;token_type&quot;</span><span class="p">:</span> <span class="n">TOKEN_TYPE</span><span class="p">,</span>
        <span class="s2">&quot;service&quot;</span><span class="p">:</span> <span class="n">SEAAUTH_SCOPE_NAME</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">urljoin</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">seaauth_url</span><span class="p">,</span> <span class="s2">&quot;/api/v1/users/rotate_token&quot;</span><span class="p">),</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Token is refreshed&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">_do_stt</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">,</span> <span class="n">access_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">stt_endpoint_url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">seavoice_ws_url</span><span class="p">,</span> <span class="s2">&quot;/api/v1/stt/ws&quot;</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;establishing ws connection...&quot;</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">websockets</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">stt_endpoint_url</span><span class="p">)</span> <span class="k">as</span> <span class="n">websocket</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;established ws connection&quot;</span><span class="p">)</span>
        <span class="n">is_begin</span><span class="p">,</span> <span class="n">is_end</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Event</span><span class="p">(),</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>

        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
            <span class="n">_receive_events</span><span class="p">(</span><span class="n">websocket</span><span class="p">,</span> <span class="n">is_begin</span><span class="p">,</span> <span class="n">is_end</span><span class="p">),</span>
            <span class="n">_send_commands</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">access_token</span><span class="p">,</span> <span class="n">websocket</span><span class="p">,</span> <span class="n">is_begin</span><span class="p">,</span> <span class="n">is_end</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># wait for audio synthesized</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;stt finished&quot;</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;disconnected ws connection...&quot;</span><span class="p">)</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">_send_commands</span><span class="p">(</span>
    <span class="n">args</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">,</span>
    <span class="n">access_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">websocket</span><span class="p">,</span>
    <span class="n">is_begin</span><span class="p">:</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Event</span><span class="p">,</span>
    <span class="n">is_end</span><span class="p">:</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Event</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;sending authentication command...&quot;</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">_send_authentication_command</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">websocket</span><span class="p">,</span> <span class="n">access_token</span><span class="p">)</span>
    <span class="n">chunk_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">sample_rate</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">AUDIO_CHUNK_INTERVAL</span><span class="p">)</span>

    <span class="c1"># wait until received the begin event from server</span>
    <span class="k">await</span> <span class="n">is_begin</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;sending audio_data commands...&quot;</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">_send_audio_data_chunkily</span><span class="p">(</span><span class="n">websocket</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">audio_path</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;sending stop commands...&quot;</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">_send_stop_command</span><span class="p">(</span><span class="n">websocket</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;waiting for end event...&quot;</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">is_end</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">_receive_events</span><span class="p">(</span><span class="n">websocket</span><span class="p">,</span> <span class="n">is_begin</span><span class="p">:</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Event</span><span class="p">,</span> <span class="n">is_end</span><span class="p">:</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Event</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">websocket</span><span class="p">:</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="n">event_name</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;event&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">event_payload</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;payload&quot;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="k">if</span> <span class="n">event_name</span> <span class="o">==</span> <span class="s2">&quot;info&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">event_payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;begin&quot;</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;received an info begin event: </span><span class="si">{</span><span class="n">event_payload</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">is_begin</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">event_payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;received an info error event: </span><span class="si">{</span><span class="n">event_payload</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;received an info error event: </span><span class="si">{</span><span class="n">event_payload</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">event_payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;end&quot;</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;received an info end event&quot;</span><span class="p">)</span>
                <span class="n">is_end</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;received an unknown info event: </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">event_name</span> <span class="o">==</span> <span class="s2">&quot;recognizing&quot;</span> <span class="ow">or</span> <span class="n">event_name</span> <span class="o">==</span> <span class="s2">&quot;recognized&quot;</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;received an </span><span class="si">{</span><span class="n">event_name</span><span class="si">}</span><span class="s2"> event: </span><span class="si">{</span><span class="n">event_payload</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;received an unknown event: </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">_send_stop_command</span><span class="p">(</span><span class="n">websocket</span><span class="p">):</span>
    <span class="n">command_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="s2">&quot;stop&quot;</span><span class="p">})</span>
    <span class="k">await</span> <span class="n">websocket</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">command_str</span><span class="p">)</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">_send_authentication_command</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">,</span> <span class="n">websocket</span><span class="p">,</span> <span class="n">access_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">contexts_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">contexts_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded contexts json file from </span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">contexts_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Not loading contexts json file from: </span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">contexts_file</span><span class="si">}</span><span class="s2"> due to exception </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">contexts_json</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">authentication_command</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="s2">&quot;authentication&quot;</span><span class="p">,</span>
        <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;token&quot;</span><span class="p">:</span> <span class="n">access_token</span><span class="p">,</span>
            <span class="s2">&quot;settings&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">lang</span><span class="p">,</span>
                <span class="s2">&quot;sample_rate&quot;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">sample_rate</span><span class="p">,</span>
                <span class="s2">&quot;itn&quot;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">enable_itn</span><span class="p">,</span>
                <span class="s2">&quot;contexts&quot;</span><span class="p">:</span> <span class="n">contexts_json</span>
            <span class="p">},</span>
        <span class="p">},</span>
    <span class="p">}</span>
    <span class="n">command_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">authentication_command</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">websocket</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">command_str</span><span class="p">)</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">_send_audio_data_chunkily</span><span class="p">(</span><span class="n">websocket</span><span class="p">,</span> <span class="n">audio_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">audio_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">audio</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">chunk_size</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">audio</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">await</span> <span class="n">_send_one_audio_data_command</span><span class="p">(</span><span class="n">websocket</span><span class="p">,</span> <span class="n">audio</span><span class="p">)</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">AUDIO_CHUNK_INTERVAL</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">_send_one_audio_data_command</span><span class="p">(</span><span class="n">websocket</span><span class="p">,</span> <span class="n">audio</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">):</span>
    <span class="n">audio_data_command</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="s2">&quot;audio_data&quot;</span><span class="p">,</span> <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()}</span>
    <span class="k">await</span> <span class="n">websocket</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">audio_data_command</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_check_file_path_exists</span><span class="p">(</span><span class="n">audio_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">audio_path</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No audio file exists at </span><span class="si">{</span><span class="n">audio_path</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_convert_argument_str_to_bool</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">:</span>
    <span class="n">args</span><span class="o">.</span><span class="n">enable_itn</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">enable_itn</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span>
    <span class="k">return</span> <span class="n">args</span>


<span class="k">def</span> <span class="nf">_is_access_token_expired</span><span class="p">(</span><span class="n">access_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="n">life_time</span> <span class="o">=</span> <span class="n">_get_token_lifetime</span><span class="p">(</span><span class="n">access_token</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">life_time</span> <span class="o">&lt;</span> <span class="n">ACCESS_TOKEN_LIFE_TIME_MINIMUM_IN_SECOND</span>


<span class="k">def</span> <span class="nf">_get_token_lifetime</span><span class="p">(</span><span class="n">access_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">jwt</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">access_token</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;verify_signature&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;exp&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid access_token format error:</span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_save_credential</span><span class="p">(</span>
    <span class="n">account</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">access_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">refresh_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">seaauth_credential_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">Path</span><span class="p">(</span><span class="n">seaauth_credential_path</span><span class="p">)</span><span class="o">.</span><span class="n">touch</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">seaauth_credential_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">({</span><span class="s2">&quot;account&quot;</span><span class="p">:</span> <span class="n">account</span><span class="p">,</span> <span class="s2">&quot;access_token&quot;</span><span class="p">:</span> <span class="n">access_token</span><span class="p">,</span> <span class="s2">&quot;refresh_token&quot;</span><span class="p">:</span> <span class="n">refresh_token</span><span class="p">},</span> <span class="n">f</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The credential is saved to </span><span class="si">{</span><span class="n">seaauth_credential_path</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_get_credential_from_file</span><span class="p">(</span><span class="n">seaauth_credential_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">seaauth_credential_path</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No credential file exists at </span><span class="si">{</span><span class="n">seaauth_credential_path</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">seaauth_credential_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">credential</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot parse </span><span class="si">{</span><span class="n">seaauth_credential_path</span><span class="si">}</span><span class="s2"> into json due to </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">error</span>

    <span class="k">if</span> <span class="s2">&quot;access_token&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">credential</span> <span class="ow">or</span> <span class="s2">&quot;refresh_token&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">credential</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">credential</span><span class="si">}</span><span class="s2"> not includes both access_token and refresh_token.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">credential</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--account&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;account of a SeaAuth account.&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--password&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;password of a SeaAuth account.&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--lang&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="n">lang</span> <span class="k">for</span> <span class="n">lang</span> <span class="ow">in</span> <span class="n">Language</span><span class="p">],</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Language of TTS server, must in [&quot;zh-TW&quot;, &quot;en-US&quot;]&#39;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--sample-rate&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;sample_rate&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Set the sample rate of speech.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--audio-path&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;audio_path&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The path of wav file for speech to text.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--seaauth-url&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;seaauth_url&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;https://seaauth.seasalt.ai&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Url of SeaAuth.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--seaauth-credential-path&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;seaauth_credential_path&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;seavoice_credential.json&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Credential storage of access token and refresh token.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--seavoice-ws-url&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;seavoice_ws_url&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;wss://seavoice.seasalt.ai&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Url of SeaVoice.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--enable-itn&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;enable_itn&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Enable the ITN feature(true or false), default is true.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--contexts-file&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;contexts_file&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to a json file containing contexts for boosting and rewrite rules.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="n">_check_file_path_exists</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">audio_path</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">_convert_argument_str_to_bool</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
</pre></div>
</div>
</section>
</section>
<section id="tts-protocols">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">TTS protocols</a><a class="headerlink" href="#tts-protocols" title="Permalink to this heading"></a></h2>
<ol class="arabic simple">
<li><p>Log into SeaAuth: <code class="docutils literal notranslate"><span class="pre">https://seaauth.seasalt.ai/api/v1/users/login</span></code></p></li>
</ol>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;username&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;password&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;scope&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;seavoice&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Obtain access token in the response</p></li>
</ol>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;account&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;access_token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eyJ0eXAiOi*****&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;token_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Bearer&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;refresh_token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;71bbffd5368*****&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Refresh access token if it is expired</p></li>
</ol>
<blockquote>
<div><p>3.1 check token lifetime</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">jwt</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">&quot;eyJ0eXAiOiJKV1.....&quot;</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">jwt</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;verify_signature&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;exp&quot;</span><span class="p">]))</span>
<span class="c1"># 2022-12-06 12:42:54</span>
</pre></div>
</div>
<p>3.2 refresh token with <code class="docutils literal notranslate"><span class="pre">https://seaauth.seasalt.ai/api/v1/users/rotate_token</span></code></p>
<p>input payload</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;access_token&quot;</span><span class="p">:</span> <span class="s2">&quot;eyJ0eXAiOi*****&quot;</span><span class="p">,</span>
   <span class="s2">&quot;refresh_token&quot;</span><span class="p">:</span> <span class="s2">&quot;71bbffd5368*****&quot;</span><span class="p">,</span>
   <span class="s2">&quot;token_type&quot;</span><span class="p">:</span> <span class="s2">&quot;Bearer&quot;</span><span class="p">,</span>
   <span class="s2">&quot;service&quot;</span><span class="p">:</span> <span class="s2">&quot;seavoice&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Output</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;access_token&quot;</span><span class="p">:</span> <span class="s2">&quot;eyJ0esr3hifi*****&quot;</span><span class="p">,</span>
   <span class="s2">&quot;refresh_token&quot;</span><span class="p">:</span> <span class="s2">&quot;fd27g1bfdg53g*****&quot;</span><span class="p">,</span>
   <span class="s2">&quot;token_type&quot;</span><span class="p">:</span> <span class="s2">&quot;Bearer&quot;</span><span class="p">,</span>
   <span class="s2">&quot;service&quot;</span><span class="p">:</span> <span class="s2">&quot;seavoice&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="4">
<li><p>Connect to SeaVoice TTS websocket server: <code class="docutils literal notranslate"><span class="pre">wss://seavoice.seasalt.ai/api/v1/tts/ws</span></code></p></li>
</ol>
<p>If successfully connected, Client sends json packages to TTS server, for example (settings and data are shown with default values),</p>
<ul class="simple">
<li><p>authentication command</p></li>
</ul>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;command&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;authentication&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{access_token}&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;settings&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;language&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;en-US&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;voice&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Mike&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>synthesis command</p></li>
</ul>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;command&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;synthesis&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;settings&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;pitch&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;speed&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;volume&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;rules&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;sample_rate&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">8000</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;text&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;ssml&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><dl class="simple">
<dt>&lt;language&gt; / &lt;voice&gt;: Choose from the following options</dt><dd><ul>
<li><dl class="simple">
<dt>zh-TW</dt><dd><ul>
<li><p>Tongtong</p></li>
<li><p>Vivian</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>en-US</dt><dd><ul>
<li><p>Mike</p></li>
<li><p>Moxie</p></li>
<li><p>Lissa</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>&lt;pitch&gt;</dt><dd><ul>
<li><p>default: 0.0</p></li>
<li><p>range: [-5.0, 5.0]</p></li>
<li><p>description: adjust the pitch of the synthesized voice, where positive values raise the pitch and negative values lower the pitch.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>&lt;speed&gt;</dt><dd><ul>
<li><p>default = 1.0</p></li>
<li><p>range: [0.0, 3.0]</p></li>
<li><p>description: adjust the speed of the synthesized voice, where values &gt; 1.0 speed up the speech and values &lt; 1.0 slows down the speech.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>&lt;volume&gt;</dt><dd><ul>
<li><p>default: 50.0</p></li>
<li><p>range: [0.0, 100.0]</p></li>
<li><p>description: adjust the volume of the synthesized voice, where values &gt; 50.0 increases the volume and values &lt; 50.0 decreases the volume.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>&lt;sample_rate&gt;</dt><dd><ul>
<li><p>default: 22050</p></li>
<li><p>range: [8000, 48000]</p></li>
<li><p>description: set the output audio sample rate</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>&lt;rules&gt;</dt><dd><ul>
<li><p>default: (empty string)</p></li>
<li><p>description: pronunciation rules as a string in the following format “&lt;WORD1&gt; | &lt;PRONUNCIATION1&gt;n&lt;WORD2&gt; | &lt;PRONUNCIATION2&gt;”</p></li>
<li><p>for “zh-TW”, pronunciation can be specified in zhuyin, pinyin, or Chinese characters, e.g. “TSMC | 台積電n你好 | ㄋㄧˇ ㄏㄠˇn為了 | wei4 le5”</p></li>
<li><p>for “en-US”, pronunciation can be specified with English words, e.g. “XÆA12 | ex ash ay twelvenSideræl|psydeereal”</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>&lt;ssml&gt;</dt><dd><ul>
<li><p>default: false</p></li>
<li><p>description: should be True if &lt;text&gt; is an SSML string, i.e. using SSML tags. See <a class="reference internal" href="#supported-ssml-tags"><span class="std std-ref">Supported SSML Tags</span></a> for more info.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<ol class="arabic simple" start="5">
<li><p>After sending the package, Client calls ws.recv() to wait for TTS server to send the streaming audio data.</p></li>
<li><p>TTS server performs synthesis and keeps sending streaming audio data to Client. The audio package format is as follows:</p></li>
</ol>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SEQ_STATUS&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;MESSAGE&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SEQ_ID&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;audio&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AUDIO_DATA&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;STATUS&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>&lt;SEQ_STATUS&gt;: Either “ok” or an error message</p></li>
<li><p>&lt;MESSAGE&gt;: Additional information based on the status</p></li>
<li><p>&lt;SEQ_ID&gt;: audio sequence id</p></li>
<li><p>&lt;STATUS&gt;: if status is 1 it means streaming synthesis is still in progress; if status is 2, it means synthesis is complete.</p></li>
</ul>
</div>
<ol class="arabic simple" start="7">
<li><p>Client receives audio data frames.</p></li>
<li><p>After finishing processing all TEXT or SSML string, TTS server closes the websocket connection.</p></li>
</ol>
<section id="sample-client-script-tts">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Sample Client Script (TTS)</a><a class="headerlink" href="#sample-client-script-tts" title="Permalink to this heading"></a></h3>
<ol class="arabic simple">
<li><p>Setup</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Python venv setup (recommends using Python 3.8.10)</span>
python3<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>venv/seavoice
<span class="nb">source</span><span class="w"> </span>venv/seavoice/bin/activate
pip<span class="w"> </span>install<span class="w"> </span>--upgrade<span class="w"> </span>pip
pip<span class="w"> </span>install<span class="w"> </span><span class="nv">websockets</span><span class="o">==</span><span class="m">10</span>.3
pip<span class="w"> </span>install<span class="w"> </span><span class="nv">aiohttp</span><span class="o">==</span><span class="m">3</span>.8.1
pip<span class="w"> </span>install<span class="w"> </span><span class="nv">PyJWT</span><span class="o">==</span><span class="m">2</span>.5.0
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Run client script</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1"># Copyright 2022  Seasalt AI, Inc</span>

<span class="sd">&quot;&quot;&quot;Client script for tts endpoint</span>

<span class="sd">prerequisite:</span>
<span class="sd">python 3.8</span>
<span class="sd">python package:</span>
<span class="sd">- aiohttp==3.8.1</span>
<span class="sd">- websockets==10.3</span>
<span class="sd">- PyJWT==2.5.0</span>

<span class="sd">Usage:</span>

<span class="sd">python tts_client.py \</span>
<span class="sd">--account test \</span>
<span class="sd">--password test \</span>
<span class="sd">--lang zh-TW \</span>
<span class="sd">--voice Tongtong \</span>
<span class="sd">--text &quot;你好這裡是Seasalt，今天的日期是&lt;say-as interpret-as=&#39;date&#39; format=&#39;m/d/Y&#39;&gt;10/11/2022&lt;/say-as&gt;&quot; \</span>
<span class="sd">--rules &quot;Seasalt | 海研科技\n&quot;</span>

<span class="sd">`--lang`: supports `zh-tw`, `en-us`, `en-gb`</span>
<span class="sd">`--text`: input text to synthesize, supports SSML format</span>
<span class="sd">`--ssml`: set this to &#39;true&#39; if the text is in SSML format</span>
<span class="sd">`--rules`: optional, globally applied pronunciation rules in the format of `&lt;word&gt; | &lt;pronunciation&gt;\n`</span>
<span class="sd">`--pitch`: optional, adjust pitch of synthesized speech, must be &gt; 0.01 or &lt; -0.01</span>
<span class="sd">`--speed`: optional, adjust speed of synthesized speech, must be &gt; 1.01 or &lt; 0.99</span>
<span class="sd">`--sample-rate`: optional, set the sample rate of synthesized speech</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">wave</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urljoin</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">aiohttp</span>
<span class="kn">import</span> <span class="nn">jwt</span>
<span class="kn">import</span> <span class="nn">websockets</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
    <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
    <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> [</span><span class="si">%(levelname)s</span><span class="s2">] </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">handlers</span><span class="o">=</span><span class="p">[</span><span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()],</span>
<span class="p">)</span>

<span class="n">SEAAUTH_SCOPE_NAME</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;seavoice&quot;</span>
<span class="n">TOKEN_TYPE</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Bearer&quot;</span>

<span class="n">VOICE_CHANNELS</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">VOICE_SAMPLE_WIDTH</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">ACCESS_TOKEN_LIFE_TIME_MINIMUM_IN_SECOND</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">60</span>


<span class="k">class</span> <span class="nc">Voices</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
    <span class="n">TONGTONG</span> <span class="o">=</span> <span class="s2">&quot;Tongtong&quot;</span>
    <span class="n">VIVIAN</span> <span class="o">=</span> <span class="s2">&quot;Vivian&quot;</span>
    <span class="n">MIKE</span> <span class="o">=</span> <span class="s2">&quot;Mike&quot;</span>
    <span class="n">MOXIE</span> <span class="o">=</span> <span class="s2">&quot;Moxie&quot;</span>
    <span class="n">LISSA</span> <span class="o">=</span> <span class="s2">&quot;Lissa&quot;</span>


<span class="k">class</span> <span class="nc">Language</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
    <span class="n">EN_US</span> <span class="o">=</span> <span class="s2">&quot;en-US&quot;</span>
    <span class="n">ZH_TW</span> <span class="o">=</span> <span class="s2">&quot;zh-TW&quot;</span>


<span class="n">VOICES_LANGUAGES_MAPPING</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">Voices</span><span class="o">.</span><span class="n">TONGTONG</span><span class="p">:</span> <span class="p">[</span><span class="n">Language</span><span class="o">.</span><span class="n">ZH_TW</span><span class="p">],</span>
    <span class="n">Voices</span><span class="o">.</span><span class="n">VIVIAN</span><span class="p">:</span> <span class="p">[</span><span class="n">Language</span><span class="o">.</span><span class="n">ZH_TW</span><span class="p">],</span>
    <span class="n">Voices</span><span class="o">.</span><span class="n">MIKE</span><span class="p">:</span> <span class="p">[</span><span class="n">Language</span><span class="o">.</span><span class="n">EN_US</span><span class="p">],</span>
    <span class="n">Voices</span><span class="o">.</span><span class="n">MOXIE</span><span class="p">:</span> <span class="p">[</span><span class="n">Language</span><span class="o">.</span><span class="n">EN_US</span><span class="p">],</span>
    <span class="n">Voices</span><span class="o">.</span><span class="n">LISSA</span><span class="p">:</span> <span class="p">[</span><span class="n">Language</span><span class="o">.</span><span class="n">EN_US</span><span class="p">],</span>
<span class="p">}</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">):</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Start to get access token.&quot;</span><span class="p">)</span>
    <span class="n">access_token</span> <span class="o">=</span> <span class="k">await</span> <span class="n">_get_access_token</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">_do_tts</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">access_token</span><span class="p">)</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">_get_access_token</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">credential</span> <span class="o">=</span> <span class="n">_get_credential_from_file</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">seaauth_credential_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">credential</span> <span class="ow">and</span> <span class="n">credential</span><span class="p">[</span><span class="s2">&quot;account&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">args</span><span class="o">.</span><span class="n">account</span><span class="p">:</span>
        <span class="n">access_token</span><span class="p">,</span> <span class="n">refresh_token</span> <span class="o">=</span> <span class="n">credential</span><span class="p">[</span><span class="s2">&quot;access_token&quot;</span><span class="p">],</span> <span class="n">credential</span><span class="p">[</span><span class="s2">&quot;refresh_token&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">_is_access_token_expired</span><span class="p">(</span><span class="n">credential</span><span class="p">[</span><span class="s2">&quot;access_token&quot;</span><span class="p">]):</span>
            <span class="n">credential</span> <span class="o">=</span> <span class="k">await</span> <span class="n">_refresh_access_token</span><span class="p">(</span><span class="n">access_token</span><span class="p">,</span> <span class="n">refresh_token</span><span class="p">)</span>
            <span class="n">_save_credential</span><span class="p">(</span>
                <span class="n">args</span><span class="o">.</span><span class="n">account</span><span class="p">,</span> <span class="n">credential</span><span class="p">[</span><span class="s2">&quot;access_token&quot;</span><span class="p">],</span> <span class="n">credential</span><span class="p">[</span><span class="s2">&quot;refresh_token&quot;</span><span class="p">],</span> <span class="n">args</span><span class="o">.</span><span class="n">seaauth_credential_path</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Got access token from </span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">seaauth_credential_path</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">credential</span> <span class="o">=</span> <span class="k">await</span> <span class="n">_login_seaauth</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">account</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">password</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">seaauth_url</span><span class="p">)</span>
        <span class="n">_save_credential</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">account</span><span class="p">,</span> <span class="n">credential</span><span class="p">[</span><span class="s2">&quot;access_token&quot;</span><span class="p">],</span> <span class="n">credential</span><span class="p">[</span><span class="s2">&quot;refresh_token&quot;</span><span class="p">],</span> <span class="n">args</span><span class="o">.</span><span class="n">seaauth_credential_path</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">credential</span><span class="p">[</span><span class="s2">&quot;access_token&quot;</span><span class="p">]</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">_refresh_access_token</span><span class="p">(</span><span class="n">access_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">refresh_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;access_token&quot;</span><span class="p">:</span> <span class="n">access_token</span><span class="p">,</span>
        <span class="s2">&quot;refresh_token&quot;</span><span class="p">:</span> <span class="n">refresh_token</span><span class="p">,</span>
        <span class="s2">&quot;token_type&quot;</span><span class="p">:</span> <span class="n">TOKEN_TYPE</span><span class="p">,</span>
        <span class="s2">&quot;service&quot;</span><span class="p">:</span> <span class="n">SEAAUTH_SCOPE_NAME</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;refresh token...&quot;</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">urljoin</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">seaauth_url</span><span class="p">,</span> <span class="s2">&quot;/api/v1/users/rotate_token&quot;</span><span class="p">),</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Token is refreshed, auth_result: </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">_login_seaauth</span><span class="p">(</span><span class="n">account</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>  <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">seaauth_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Login with SeaAuth.</span>
<span class="sd">    Example of response:</span>
<span class="sd">        {</span>
<span class="sd">        &quot;account&quot;: &quot;test&quot;,</span>
<span class="sd">        &quot;access_token&quot;: &quot;eyJ0eXAiOi*****&quot;,</span>
<span class="sd">        &quot;token_type&quot;: &quot;Bearer&quot;,</span>
<span class="sd">        &quot;refresh_token&quot;: &quot;71bbffd5368*****&quot;</span>
<span class="sd">        }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="n">account</span><span class="p">,</span> <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="n">password</span><span class="p">,</span> <span class="s2">&quot;scope&quot;</span><span class="p">:</span> <span class="n">SEAAUTH_SCOPE_NAME</span><span class="p">}</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">FormData</span><span class="p">()</span>
    <span class="n">data</span><span class="o">.</span><span class="n">add_fields</span><span class="p">(</span><span class="o">*</span><span class="n">payload</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">urljoin</span><span class="p">(</span><span class="n">seaauth_url</span><span class="p">,</span> <span class="s2">&quot;/api/v1/users/login&quot;</span><span class="p">),</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">data</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">_do_tts</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">,</span> <span class="n">access_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">tts_endpoint_url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">seavoice_ws_url</span><span class="p">,</span> <span class="s2">&quot;/api/v1/tts/ws&quot;</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;establishing ws connection...&quot;</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">websockets</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">tts_endpoint_url</span><span class="p">)</span> <span class="k">as</span> <span class="n">websocket</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;established ws connection&quot;</span><span class="p">)</span>
        <span class="n">is_begin</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
        <span class="n">is_synthesized</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
            <span class="n">_receive_events</span><span class="p">(</span><span class="n">websocket</span><span class="p">,</span> <span class="n">is_begin</span><span class="p">,</span> <span class="n">is_synthesized</span><span class="p">,</span> <span class="n">args</span><span class="p">),</span>
            <span class="n">_send_commands</span><span class="p">(</span><span class="n">websocket</span><span class="p">,</span> <span class="n">access_token</span><span class="p">,</span> <span class="n">is_begin</span><span class="p">,</span> <span class="n">is_synthesized</span><span class="p">,</span> <span class="n">args</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;tts finished&quot;</span><span class="p">)</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">_send_commands</span><span class="p">(</span>
    <span class="n">websocket</span><span class="p">,</span>
    <span class="n">access_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">is_begin</span><span class="p">:</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Event</span><span class="p">,</span>
    <span class="n">is_synthesized</span><span class="p">:</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Event</span><span class="p">,</span>
    <span class="n">args</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;sending authentication command...&quot;</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">_send_authentication_command</span><span class="p">(</span><span class="n">websocket</span><span class="p">,</span> <span class="n">access_token</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
    <span class="c1"># wait until received the begin event from server</span>
    <span class="k">await</span> <span class="n">is_begin</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;sending synthesis commands...&quot;</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">_send_synthesis_commands</span><span class="p">(</span><span class="n">websocket</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>

    <span class="c1"># wait for audio synthsized</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;waiting is_synthesized event...&quot;</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">is_synthesized</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">websocket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">_receive_events</span><span class="p">(</span>
    <span class="n">websocket</span><span class="p">,</span>
    <span class="n">is_begin</span><span class="p">:</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Event</span><span class="p">,</span>
    <span class="n">is_synthesized</span><span class="p">:</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Event</span><span class="p">,</span>
    <span class="n">args</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span>
<span class="p">):</span>
    <span class="k">with</span> <span class="n">wave</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>

        <span class="n">f</span><span class="o">.</span><span class="n">setnchannels</span><span class="p">(</span><span class="n">VOICE_CHANNELS</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">setsampwidth</span><span class="p">(</span><span class="n">VOICE_SAMPLE_WIDTH</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">setframerate</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">sample_rate</span><span class="p">)</span>

        <span class="k">async</span> <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">websocket</span><span class="p">:</span>
            <span class="n">event</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
            <span class="n">event_name</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;event&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">event_payload</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;payload&quot;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="k">if</span> <span class="n">event_name</span> <span class="o">==</span> <span class="s2">&quot;info&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">event_payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;begin&quot;</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;received an info event: </span><span class="si">{</span><span class="n">event_payload</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">is_begin</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">event_payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;received an error event: </span><span class="si">{</span><span class="n">event_payload</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;received an error event: </span><span class="si">{</span><span class="n">event_payload</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">event_name</span> <span class="o">==</span> <span class="s2">&quot;audio_data&quot;</span><span class="p">:</span>
                <span class="n">synthesis_status</span> <span class="o">=</span> <span class="n">event_payload</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;received an audio_data event, staus:</span><span class="si">{</span><span class="n">synthesis_status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="c1"># warning: it&#39;s a IO blocking operation.</span>
                <span class="n">f</span><span class="o">.</span><span class="n">writeframes</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">event_payload</span><span class="p">[</span><span class="s2">&quot;audio&quot;</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">synthesis_status</span> <span class="o">==</span> <span class="s2">&quot;synthesized&quot;</span><span class="p">:</span>
                    <span class="n">is_synthesized</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;received an unknown event: </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">_send_authentication_command</span><span class="p">(</span>
    <span class="n">websocket</span><span class="p">,</span>
    <span class="n">access_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">args</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span>
<span class="p">):</span>
    <span class="n">authentication_command</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="s2">&quot;authentication&quot;</span><span class="p">,</span>
        <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;token&quot;</span><span class="p">:</span> <span class="n">access_token</span><span class="p">,</span>
            <span class="s2">&quot;settings&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">lang</span><span class="p">,</span>
                <span class="s2">&quot;voice&quot;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">voice</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">},</span>
    <span class="p">}</span>
    <span class="n">command_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">authentication_command</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">websocket</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">command_str</span><span class="p">)</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">_send_synthesis_commands</span><span class="p">(</span><span class="n">websocket</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">):</span>
    <span class="n">synthesis_command</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="s2">&quot;synthesis&quot;</span><span class="p">,</span>
        <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;settings&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;pitch&quot;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">pitch</span><span class="p">,</span>
                <span class="s2">&quot;speed&quot;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">speed</span><span class="p">,</span>
                <span class="s2">&quot;volume&quot;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">volume</span><span class="p">,</span>
                <span class="s2">&quot;rules&quot;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">rules</span><span class="p">,</span>
                <span class="s2">&quot;sample_rate&quot;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">sample_rate</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;ssml&quot;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">ssml</span><span class="p">},</span>
        <span class="p">},</span>
    <span class="p">}</span>
    <span class="n">command_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">synthesis_command</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">websocket</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">command_str</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_check_voice</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">lang</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">VOICES_LANGUAGES_MAPPING</span><span class="p">[</span><span class="n">args</span><span class="o">.</span><span class="n">voice</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">voice</span><span class="si">}</span><span class="s2"> only support </span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">VOICES_LANGUAGES_MAPPING</span><span class="p">[</span><span class="n">args</span><span class="o">.</span><span class="n">voice</span><span class="p">])</span><span class="si">}</span><span class="s2">, the input is </span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">lang</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>


<span class="k">def</span> <span class="nf">_convert_argument_str_to_bool</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">:</span>
    <span class="n">args</span><span class="o">.</span><span class="n">ssml</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">ssml</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span>
    <span class="k">return</span> <span class="n">args</span>


<span class="k">def</span> <span class="nf">_is_access_token_expired</span><span class="p">(</span><span class="n">access_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="n">life_time</span> <span class="o">=</span> <span class="n">_get_token_lifetime</span><span class="p">(</span><span class="n">access_token</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">life_time</span> <span class="o">&lt;</span> <span class="n">ACCESS_TOKEN_LIFE_TIME_MINIMUM_IN_SECOND</span>


<span class="k">def</span> <span class="nf">_get_token_lifetime</span><span class="p">(</span><span class="n">access_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">jwt</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">access_token</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;verify_signature&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;exp&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid access_token format error:</span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_save_credential</span><span class="p">(</span>
    <span class="n">account</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">access_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">refresh_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">seaauth_credential_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">Path</span><span class="p">(</span><span class="n">seaauth_credential_path</span><span class="p">)</span><span class="o">.</span><span class="n">touch</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">seaauth_credential_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">({</span><span class="s2">&quot;account&quot;</span><span class="p">:</span> <span class="n">account</span><span class="p">,</span> <span class="s2">&quot;access_token&quot;</span><span class="p">:</span> <span class="n">access_token</span><span class="p">,</span> <span class="s2">&quot;refresh_token&quot;</span><span class="p">:</span> <span class="n">refresh_token</span><span class="p">},</span> <span class="n">f</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The credential is saved to </span><span class="si">{</span><span class="n">seaauth_credential_path</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_get_credential_from_file</span><span class="p">(</span><span class="n">seaauth_credential_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">seaauth_credential_path</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No credential file exists at </span><span class="si">{</span><span class="n">seaauth_credential_path</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">seaauth_credential_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">credential</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot parse </span><span class="si">{</span><span class="n">seaauth_credential_path</span><span class="si">}</span><span class="s2"> into json due to </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">error</span>

    <span class="k">if</span> <span class="s2">&quot;access_token&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">credential</span> <span class="ow">or</span> <span class="s2">&quot;refresh_token&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">credential</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">credential</span><span class="si">}</span><span class="s2"> not includes both access_token and refresh_token.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">credential</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--account&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;account of a SeaAuth account.&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--password&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;password of a SeaAuth account.&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--lang&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="n">lang</span> <span class="k">for</span> <span class="n">lang</span> <span class="ow">in</span> <span class="n">Language</span><span class="p">],</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Language of TTS server, must in [&quot;zh-TW&quot;, &quot;en-US&quot;]&#39;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--voice&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="n">voice</span> <span class="k">for</span> <span class="n">voice</span> <span class="ow">in</span> <span class="n">Voices</span><span class="p">],</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Voice of the synthesized.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--text&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Text to synthesize. Supports SSML text.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--ssml&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;false&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Set this to true if text is in SSML format.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--seaauth-url&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;seaauth_url&quot;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;https://seaauth.seasalt.ai&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Url of SeaAuth.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--seaauth-credential-path&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;seaauth_credential_path&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;seavoice_credential.json&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Credential storage of access token and refresh token.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--seavoice-ws-url&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;seavoice_ws_url&quot;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;wss://seavoice.seasalt.ai&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Url of SeaVoice.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--rules&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Global pronunciation rules.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--output&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;test_audio.wav&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to output audio file.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--sample-rate&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;sample_rate&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">22050</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Optional, set the sample rate of synthesized speech, default 22050.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--pitch&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Optional, adjust pitch of synthesized speech, [-5, 5] default is 0.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--speed&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Optional, adjust speed of synthesized speech, [0, 2] default is 1.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--volume&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mf">50.0</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Optional, adjust volume of synthesize speech, [0, 100] default is 50.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="n">_check_voice</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">_convert_argument_str_to_bool</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="supported-ssml-tags">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">Supported SSML Tags</a><a class="headerlink" href="#supported-ssml-tags" title="Permalink to this heading"></a></h3>
<ol class="arabic simple">
<li><p>Break</p></li>
</ol>
<p>Description: Add pauses to the synthesized speech, measured in milliseconds.</p>
<p>Format: <code class="docutils literal notranslate"><span class="pre">&lt;break</span> <span class="pre">time=&quot;100ms&quot;/&gt;</span></code></p>
<p>Examples:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">今天&lt;break</span> <span class="pre">time=&quot;100ms&quot;/&gt;的日期是3/22/2022</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Today</span> <span class="pre">&lt;break</span> <span class="pre">time=&quot;100ms&quot;/&gt;</span> <span class="pre">the</span> <span class="pre">date</span> <span class="pre">is</span> <span class="pre">3/22/2022</span></code></p></li>
</ul>
<p>2. Alias
Description: Specify pronunciation.</p>
<p>Format:  <code class="docutils literal notranslate"><span class="pre">&lt;alias</span> <span class="pre">alphabet=”{sub|arpabet|zhuyin|pinyin}”</span> <span class="pre">ph='...'&gt;...&lt;/alias&gt;</span></code></p>
<p>Examples:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;alias</span> <span class="pre">alphabet='sub'</span> <span class="pre">ph='see</span> <span class="pre">salt</span> <span class="pre">dot</span> <span class="pre">ay</span> <span class="pre">eye'&gt;Seasalt.ai&lt;/alias&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">代碼&lt;alias</span> <span class="pre">alphabet='sub'</span> <span class="pre">ph='維'&gt;為&lt;/sub&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;alias</span> <span class="pre">alphabet='arpabet'</span> <span class="pre">ph='HH</span> <span class="pre">AH0</span> <span class="pre">L</span> <span class="pre">OW1'&gt;hello&lt;/alias&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">代碼&lt;alias</span> <span class="pre">alphabet='zhuyin'</span> <span class="pre">ph='ㄨㄟˊ'&gt;為&lt;/alias&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">代碼&lt;alias</span> <span class="pre">alphabet='pinyin'</span> <span class="pre">ph='wei2'&gt;為&lt;/alias&gt;</span></code></p></li>
</ul>
<ol class="arabic simple" start="3">
<li><p>Say-as</p></li>
</ol>
<p>Description: Specify how to interpret ambiguous text like numbers and dates.</p>
<p>Format: <code class="docutils literal notranslate"><span class="pre">&lt;say-as</span> <span class="pre">interpret-as='{digits|cardinal|spell-out|date}'</span> <span class="pre">format='{phone|social|m/d/Y|...}'&gt;...&lt;/say-as&gt;</span></code></p>
<p>Examples:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Today</span> <span class="pre">is</span> <span class="pre">&lt;say-as</span> <span class="pre">interpret-as='date'</span> <span class="pre">format='m/d/Y'&gt;2/11/2022&lt;/say-as&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">my</span> <span class="pre">phone</span> <span class="pre">number</span> <span class="pre">is</span> <span class="pre">&lt;say-as</span> <span class="pre">interpret-as='digits'</span> <span class="pre">format='phone'&gt;7145262155&lt;/say-as&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">the</span> <span class="pre">word</span> <span class="pre">diarization</span> <span class="pre">is</span> <span class="pre">spelled</span> <span class="pre">&lt;say-as</span> <span class="pre">interpret-as='spell-out'&gt;diarization&lt;/say-as&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">今天的日期是&lt;say-as</span> <span class="pre">interpret-as='date'</span> <span class="pre">format='m/d/Y'&gt;3/15/2022&lt;/say-as&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">我的電話號碼是&lt;say-as</span> <span class="pre">interpret-as='digits'</span> <span class="pre">format='mobile'&gt;1234567890&lt;/say-as&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">訂位代碼為&lt;say-as</span> <span class="pre">interpret-as='spell-out'&gt;5VOPXT&lt;/say-as&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">訂位代碼為&lt;say-as</span> <span class="pre">interpret-as='spell-out'</span> <span class="pre">time='600ms'=&gt;5VOPXT&lt;/say-as&gt;</span></code></p></li>
</ul>
</section>
<section id="special-symbol-handling">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Special Symbol Handling</a><a class="headerlink" href="#special-symbol-handling" title="Permalink to this heading"></a></h3>
<p>SeaVoice automatically handles and pronounces the following symbols:</p>
<ul class="simple">
<li><p>en-US</p></li>
</ul>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Symbol</p></th>
<th class="head"><p>Pronunciation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>#</p></td>
<td><p>hastag</p></td>
</tr>
<tr class="row-odd"><td><p>&amp;</p></td>
<td><p>and</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>zh-TW</p></li>
</ul>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Symbol</p></th>
<th class="head"><p>Pronunciation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>%</p></td>
<td><p>趴</p></td>
</tr>
<tr class="row-odd"><td><p>％</p></td>
<td><p>趴</p></td>
</tr>
<tr class="row-even"><td><p>&gt;</p></td>
<td><p>大於</p></td>
</tr>
<tr class="row-odd"><td><p>＞</p></td>
<td><p>大於</p></td>
</tr>
<tr class="row-even"><td><p>&lt;</p></td>
<td><p>小於</p></td>
</tr>
<tr class="row-odd"><td><p>＜</p></td>
<td><p>小於</p></td>
</tr>
<tr class="row-even"><td><p>=</p></td>
<td><p>等於</p></td>
</tr>
<tr class="row-odd"><td><p>＝</p></td>
<td><p>等於</p></td>
</tr>
<tr class="row-even"><td><p>+</p></td>
<td><p>加</p></td>
</tr>
<tr class="row-odd"><td><p>＋</p></td>
<td><p>加</p></td>
</tr>
<tr class="row-even"><td><p>°C</p></td>
<td><p>度C</p></td>
</tr>
<tr class="row-odd"><td><p>℃</p></td>
<td><p>度C</p></td>
</tr>
<tr class="row-even"><td><p>°F</p></td>
<td><p>度F</p></td>
</tr>
<tr class="row-odd"><td><p>℉</p></td>
<td><p>度F</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>If you wish to interpret and pronounce these symbols differently, you should use the SSML tags as defined above.</p></li>
<li><p>Some of the symbols might look alike when renderd on your browser but actually have different encodings.</p></li>
<li><p>en-US symbol handling is also used in zh-TW due to common code-switching in zh-TW.</p></li>
</ul>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="seavoice_sdk_python_tutorial.html" class="btn btn-neutral float-left" title="SeaVoice Python SDK" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../auth/readme.html" class="btn btn-neutral float-right" title="SeaAuth Overview" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-Today, Seasalt.ai.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-10405841-8"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-10405841-8', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>